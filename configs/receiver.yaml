# 受け手予測タスクの設定ファイル

# モデル設定
model:
  input_dim: 16  # ノード特徴量の次元数 (default=16): x, y, vx, vy, height, weight, dx_to_kicker, dy_to_kicker, dist_to_kicker, angle_to_kicker, dx_to_goal, dy_to_goal, dist_to_goal, angle_to_goal, ball, team
  hidden_dim: 128  # 隠れ層の次元数 (default=128)
  num_classes: 22  # クラス数（プレイヤー数）(default=22)
  num_layers: 3  # GATv2レイヤー数 (default=3)
  num_heads: 4  # アテンションヘッド数 (default=4)
  dropout: 0.2  # ドロップアウト率 (default=0.2, 推奨範囲: 0.1-0.3, 安定した学習のため推奨)

# オプティマイザー設定
optimizer:
  type: "adam"  # オプティマイザーの種類 (default="adam")
  lr: 0.0003  # 学習率 (default=0.0003, 安定した学習のため推奨, 範囲: 0.0001-0.01)
  weight_decay: 0.0001  # 重み減衰（L2正則化）(default=0.0001, 安定した学習のため推奨, 範囲: 0.0001-0.001)

# スケジューラー設定
scheduler:
  type: "cosine"  # スケジューラーの種類 (default="none", 選択肢: "none", "step", "cosine", "multistep")
  T_max: 50  # コサインアニーリングの周期（エポック数）(default=train.epochs)
  eta_min: 1e-6  # 最小学習率 (default=1e-6)
  warmup_epochs: 5  # ウォームアップエポック数 (default=5)
  # type="step"の場合の設定例:
  # step_size: 10  # 学習率を減らすエポック間隔 (default=10)
  # gamma: 0.5  # 学習率の減衰率 (default=0.5)

# 学習設定
train:
  batch_size: 32  # バッチサイズ (default=8, 安定した学習のため推奨)
  epochs: 50  # 最大エポック数 (default=100)
  amp: true  # Automatic Mixed Precisionの使用 (default=false, 推奨: trueで高速化)
  # 勾配クリッピング設定
  grad_clip:
    enabled: false  # 勾配クリッピングの有効化 (default=true, 安定した学習のため推奨)
    max_norm: 1.0  # 勾配の最大ノルム (default=1.0, 推奨範囲: 0.5-2.0)

# データ設定
data:
  train_path: "data/processed_ck/receiver_train/data.pickle"  # 訓練データのパス
  val_path: "data/processed_ck/receiver_val/data.pickle"  # 検証データのパス
  test_path: "data/processed_ck/receiver_test/data.pickle"  # テストデータのパス
  format: "pickle"  # データ形式 (default="pickle")

# 損失関数設定
loss:
  type: "cross_entropy"  # 損失関数の種類 (default="cross_entropy")
  label_smoothing: 0.1  # ラベルスムージング率 (default=0.1, 安定した学習のため推奨, 範囲: 0.05-0.1)
  weight: 1.0  # 損失の重み (default=1.0)
  
  # Focal Lossのパラメータ（cross_entropyの代替）
  focal_loss:
    enabled: false  # Focal Lossの使用 (default=false)
    alpha: 1.0  # レアクラスの重み係数 (default=1.0)
    gamma: 2.0  # フォーカシングパラメータ (default=2.0)
    
  # クラス重み（不均衡データセット用）
  class_weights: null  # クラスごとの重み [w_0, w_1, ..., w_{num_classes-1}] (default=null)
  
  # 正則化項
  regularization:
    l2_weight: 0.0001  # L2正則化の重み (default=0.0, 推奨: 0.0001-0.001)
    dropout_rate: 0.2  # ドロップアウト正則化の重み (default=0.0)

# D2等変性設定
d2:
  group_pool: false  # グループプーリングの使用 (default=false, ReceiverModelが内部でD2を処理)
  transforms:
    hflip: true  # 水平フリップのデータ拡張 (default=false, 原因切り分けのためfalse推奨, ただし通常はtrueを推奨)
    vflip: true  # 垂直フリップのデータ拡張 (default=false, 原因切り分けのためfalse推奨, ただし通常はtrueを推奨)

# Early Stopping設定
early_stopping:
  patience: 10  # 改善が見られない場合の待機エポック数 (default=10)
  min_delta: 0.01  # 改善とみなす最小変化量 (default=0.001)

# 評価設定
eval:
  batch_size: 5  # 評価時のバッチサイズ (default=5)
  min_cands_eval: 1  # 評価に必要な最小候補数 (default=1)

# システム設定
device: "auto"  # デバイス (default="auto", 選択肢: "auto", "cpu", "cuda", "mps")
seed: 42  # 乱数シード (default=42)
num_workers: 4  # データローダーのワーカー数 (default=4)
prefetch_factor: 2  # プリフェッチ係数 (default=2)
persistent_workers: true  # ワーカーをエポック間で保持 (default=true, オーバーヘッド削減)
log_level: "INFO"  # ログレベル (default="INFO")
log_dir: "runs"  # ログ保存ディレクトリ (default="runs")
checkpoint_dir: "checkpoints"  # チェックポイント保存ディレクトリ (default="checkpoints")
